name: Generate HTML Index

on:
  push:
    branches:
      - main

jobs:
  generate_index:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install bash
        run: sudo apt-get install bash  # å®‰è£… bash è§£é‡Šå™¨ï¼Œå¦‚æœéœ€è¦çš„è¯

      - name: Generate HTML index
        run: |
          # å¼€å§‹ç”Ÿæˆåˆ—è¡¨
          # æ·»åŠ æ— éœ€è½¬ä¹‰çš„ HTML ä»£ç æ®µ
          htmlhead='<!DOCTYPE html><html>  <head>    	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />	<meta name="viewport" content="width=device-width, initial-scale=1.0" />    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">	<link rel="manifest" href="/site.webmanifest">    <title>çŒ«ç¬”åˆ€å†å²æ–‡ç« åˆé›†</title>	<script>		var _hmt = _hmt || [];		(function() {		var hm = document.createElement("script");		hm.src = "https://hm.baidu.com/hm.js?2ce78cdc63eac5c2b834e88b66929dcd";		var s = document.getElementsByTagName("script")[0]; 		s.parentNode.insertBefore(hm, s);		})();	</script>  </head>  <body>  <div style="clear:both;">  <img src="/qr100.jpg" alt="åŠ å¾®ä¿¡ä¸€èµ·èŠğŸ™‚" style="float:right;margin-right:10px;">  </div><h1 style="font-size:24px;">çŒ«ç¬”åˆ€å†å²æ–‡ç« åˆé›†</h1><br />(æˆ‘æ˜¯ä¸€ä¸ªç å†œï¼Œå¹³æ—¶å–œæ¬¢å–èŒ¶ç‚’è‚¡ï¼Œæ¬¢è¿ä¸€èµ·å­¦ä¹ äº¤æµï¼š QQ316716198 [å¾®ä¿¡åŒå·] )<br /><hr />'
  
          echo "$htmlhead" > index.html
          echo "<ul>" >> index.html
          # è·å–ä»¥ "202" å¼€å¤´çš„ç›®å½•
          for dir in $(find . -type d -name "202*"); do
              dir_name=$(basename "$dir")
              echo "<li><strong>$dir_name</strong></li>" >> index.html
              echo "<ul>" >> index.html
              # è·å–ç›®å½•ä¸‹çš„ HTML æ–‡ä»¶å¹¶å»æ‰è·¯å¾„å‰çš„ "./"
              for file in $(find "$dir" -maxdepth 1 -name '*.html'); do
                  file_name=$(basename "$file")
                  echo "<li><a href=\"$file\" target=\"_blank\">$file_name</a></li>" >> index.html
              done
              echo "</ul>" >> index.html
          done
          echo "</ul>" >> index.html

          # æ·»åŠ æ— éœ€è½¬ä¹‰çš„ HTML ä»£ç æ®µ
          htmlfoot='<hr />(æˆ‘æ˜¯ä¸€ä¸ªç å†œï¼Œå¹³æ—¶å–œæ¬¢å–èŒ¶ç‚’è‚¡ï¼Œæ¬¢è¿ä¸€èµ·å­¦ä¹ äº¤æµï¼š QQ316716198 [å¾®ä¿¡åŒå·] )  <div style="clear:both;">    <img src="/qr100.jpg" alt="åŠ å¾®ä¿¡ä¸€èµ·èŠğŸ™‚" style="clear:both;display:block;margin:auto;">  </div>  </body> </html>'  
          echo "$htmlfoot" >> index.html
          echo "ç”ŸæˆæˆåŠŸï¼šindex.html"

      - name: Commit and push changes
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Actions"
          git add index.html
          git commit -m "Generate HTML index"
          git push
